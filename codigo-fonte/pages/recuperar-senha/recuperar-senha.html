<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recuperar Senha | finanfy</title>
    <link href="recuperar-senha.css" rel="stylesheet" />
  </head>
  <body>
    <form id="recoveryForm">
      <h1><strong>Recuperar senha</strong></h1>
      <br /><br />

      <input placeholder="Email" class="areaText" id="email" /><br /><br />

      <select class="areaText" id="perguntaSeguranca">
        <option value="   Pergunta de segurança" id="0">
          Pergunta de segurança
        </option>
        <option value="Nome da Mãe" id="1">Qual o Nome da sua Mãe?</option>
        <option value="Nome do Pai" id="2">Qual o Nome do seu Pai?</option>
        <option value="Time que voce Torce" id="3">
          Para Qual Time voce Torce?
        </option>
        <option value="Data de Nascimento" id="4">
          Qual a sua data de nascimento?
        </option>
      </select>

      <br /><br />
      <input
        placeholder="Resposta de segurança"
        class="areaText"
        id="securityAnswer"
      />
      <br /><br />
      <input placeholder="Nova senha" class="areaText" id="newPassword" />
      <br /><br />
      <input
        placeholder="Confirme sua nova senha"
        id="confirmNewPassword"
        class="areaText"
      /><br /><br />
      <button type="button" onclick="changePassword()">
        <img src="../../assets/icon-send.png" />
      </button>
    </form>

    <script>
      function changePassword() {
        const email = document.getElementById("email").value;
        const divQuestionSecurity =
          document.getElementById("perguntaSeguranca");
        const questionSecurity =
          divQuestionSecurity.options[divQuestionSecurity.selectedIndex].id;
        const securityAnswer = document.getElementById("securityAnswer").value;
        const newPassword = document.getElementById("newPassword").value;
        const confirmNewPassword =
          document.getElementById("confirmNewPassword").value;

        if (!email || email === "") {
          return alert("É necessário preencher o email");
        }
        if (questionSecurity === "0") {
          return alert("É necessário selecionar uma pergunta de segurança");
        }
        if (!securityAnswer || securityAnswer === "") {
          return alert("É necessário preencher a resposta de segurança");
        }
        if (!newPassword || newPassword === "") {
          return alert("É necessário preencher a nova senha");
        }
        if (!confirmNewPassword || confirmNewPassword === "") {
          return alert("É necessário preencher a confirmação de senha");
        }
        if (confirmNewPassword !== newPassword) {
          return alert("As senhas não conferem");
        }

        const users = JSON.parse(localStorage.getItem("db_usuarios")) || [];
        console.log("ENTROU AQUI1", users);
        for (const element of users.usuarios) {
          console.log("ENTROU AQUI2");
          if (
            element.email === email &&
            element.respSecurity === securityAnswer &&
            element.questionSecurity === questionSecurity
          ) {
            element.senha = newPassword;
            localStorage.setItem("db_usuarios", JSON.stringify(users));
            alert("Senha alterada com sucesso.");
            window.location.href = "../Login/login.html";
            return;
          }
        }

        alert(
          "Email, pergunta ou resposta de segurança incorretos. Tente novamente."
        );
      }
    </script>
  </body>
</html>
